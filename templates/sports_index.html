{% extends "sports_layout.html" %}

{% block content %}
<div class="space-y-6">
    <!-- Header with Filters -->
    <div class="flex flex-col gap-4 bg-white p-6 rounded-2xl shadow-sm border border-zinc-200">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div>
                <h1 class="text-2xl font-bold tracking-tight text-zinc-900">Match Schedule</h1>
                <p class="text-zinc-500 text-sm mt-1">Upcoming fixtures and real-time AI analysis.</p>
            </div>

            <!-- Search -->
            <div class="relative w-full md:w-64">
                <input type="text" id="teamSearch" placeholder="Search teams..."
                    class="w-full pl-10 pr-4 py-2 bg-zinc-50 border border-zinc-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent transition-all">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg class="h-4 w-4 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Scrollable League Strip -->
        <div class="flex overflow-x-auto pb-2 -mx-2 px-2 gap-2 no-scrollbar"
            style="-ms-overflow-style: none; scrollbar-width: none;">
            <style>
                .no-scrollbar::-webkit-scrollbar {
                    display: none;
                }
            </style>
            {% set leagues = [
            ('all', 'All'),
            ('epl', 'EPL'),
            ('laliga', 'La Liga'),
            ('bundesliga', 'Bundesliga'),
            ('seriea', 'Serie A'),
            ('ligue1', 'Ligue 1'),
            ('ucl', 'UCL'),
            ('europa', 'Europa'),
            ('afcon', 'AFCON'),
            ('worldcup', 'World Cup'),
            ('mls', 'MLS'),
            ('brasileiro', 'Brazil Serie A'),
            ('saudi', 'Saudi Pro'),
            ('championship', 'EFL'),
            ('nba', 'NBA')
            ] %}

            {% for code, name in leagues %}
            <a href="?league={{ code }}" class="whitespace-nowrap px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 flex-shrink-0
               {% if active_league == code %}
               bg-zinc-900 text-white shadow-md
               {% else %}
               bg-zinc-100 text-zinc-600 hover:bg-zinc-200
               {% endif %}">
                {{ name }}
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- Match List -->
    <div class="bg-white rounded-2xl shadow-sm border border-zinc-200 overflow-hidden">
        {% if games %}
        <div class="divide-y divide-zinc-100">
            {% for game in games %}
            <div
                class="group p-5 hover:bg-zinc-50 transition-colors duration-200 flex flex-col md:flex-row items-center gap-6">

                <!-- Time / Status -->
                <div class="md:w-32 flex flex-col items-center md:items-start text-center md:text-left shrink-0">
                    {% if game.league_name %}
                    <div class="flex flex-col mb-1">
                        <span class="text-[10px] text-zinc-400 font-bold uppercase tracking-wide">{{ game.league_name
                            }}</span>
                        <!-- Sport Label -->
                        {% if 'nba' in game.league %}
                        <span class="text-[9px] text-blue-500 font-bold uppercase">Basketball</span>
                        {% else %}
                        <span class="text-[9px] text-green-500 font-bold uppercase">Soccer</span>
                        {% endif %}
                    </div>
                    {% endif %}

                    {% if game.status == 'in' %}
                    <span
                        class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800 animate-pulse mb-1">
                        ‚óè LIVE
                    </span>
                    <span class="text-red-600 font-bold text-sm">{{ game.status_detail }}</span>
                    {% else %}
                    <span class="text-zinc-600 text-xs font-semibold uppercase tracking-wider mb-1">
                        {{ game.date | to_nigerian_time }}
                    </span>
                    <span class="text-zinc-400 text-xs bg-zinc-100 px-2 py-1 rounded-md">{{ game.status_detail }}</span>
                    {% endif %}
                </div>

                <!-- Teams Matchup -->
                <div class="flex-1 grid grid-cols-7 items-center w-full">
                    <!-- Home -->
                    <div class="col-span-3 flex items-center justify-end gap-3 text-right">
                        <span class="font-semibold text-zinc-900 md:text-lg truncate">{{ game.home_team.name }}</span>
                        {% if game.home_team.logo %}
                        <img src="{{ game.home_team.logo }}" class="w-8 h-8 md:w-10 md:h-10 object-contain shrink-0">
                        {% else %}
                        <div class="w-8 h-8 md:w-10 md:h-10 bg-zinc-200 rounded-full shrink-0"></div>
                        {% endif %}
                    </div>

                    <!-- Score / VS -->
                    <div class="col-span-1 flex justify-center">
                        <div
                            class="w-16 h-8 flex items-center justify-center bg-zinc-100 rounded-lg text-sm font-bold font-mono text-zinc-700">
                            {% if game.status == 'pre' %}
                            <span class="text-zinc-400">VS</span>
                            {% else %}
                            {{ game.home_team.score }} - {{ game.away_team.score }}
                            {% endif %}
                        </div>
                    </div>

                    <!-- Away -->
                    <div class="col-span-3 flex items-center justify-start gap-3 text-left">
                        {% if game.away_team.logo %}
                        <img src="{{ game.away_team.logo }}" class="w-8 h-8 md:w-10 md:h-10 object-contain shrink-0">
                        {% else %}
                        <div class="w-8 h-8 md:w-10 md:h-10 bg-zinc-200 rounded-full shrink-0"></div>
                        {% endif %}
                        <span class="font-semibold text-zinc-900 md:text-lg truncate">{{ game.away_team.name }}</span>
                    </div>
                </div>

                <!-- Action -->
                <div class="w-full md:w-auto mt-4 md:mt-0 md:ml-auto">
                    <button
                        onclick="predictMatch('{{ game.id }}', '{{ game.home_team.name }}', '{{ game.away_team.name }}', '{{ active_league }}')"
                        class="w-full md:w-auto px-6 py-2.5 bg-black text-white text-sm font-medium rounded-xl hover:bg-zinc-800 transition-all shadow-sm hover:shadow active:scale-95 flex items-center justify-center gap-2">
                        <svg class="w-4 h-4 text-zinc-400" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                d="M19.428 15.428a2 2 0 00-1.022-.547l-2.384-.477a6 6 0 00-3.86.517l-.318.158a6 6 0 01-3.86.517L6.05 15.21a2 2 0 00-1.806.547M8 4h8l-1 1v5.172a2 2 0 00.586 1.414l5 5c1.26 1.26.367 3.414-1.415 3.414H4.828c-1.782 0-2.674-2.154-1.414-3.414l5-5A2 2 0 009 10.172V5L8 4z" />
                        </svg>
                        AI Predict
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        {% else %}
        <div class="flex flex-col items-center justify-center py-24 text-center">
            <div class="w-16 h-16 bg-zinc-50 rounded-full flex items-center justify-center mb-4">
                <svg class="w-8 h-8 text-zinc-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                    </path>
                </svg>
            </div>
            <h3 class="text-lg font-medium text-zinc-900">No Matches Found</h3>
            <p class="text-zinc-500 mt-1 max-w-sm">No upcoming matches scheduled for this league. Try checking the
                history or switching leagues.</p>
            <a href="?league=all" class="mt-4 text-black text-sm font-medium hover:underline">Return to All</a>
        </div>
        {% endif %}
    </div>
</div>

<script>
    // Client-side search for matches
    document.getElementById('teamSearch').addEventListener('keyup', function (e) {
        const term = e.target.value.toLowerCase();
        const matches = document.querySelectorAll('.group'); // Each match row has class 'group'

        matches.forEach(match => {
            const text = match.innerText.toLowerCase();
            if (text.includes(term)) {
                match.style.display = 'flex';
            } else {
                match.style.display = 'none';
            }
        });
    });
</script>

{% endblock %}