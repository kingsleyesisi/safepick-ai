{% extends "sports_layout.html" %}

{% block content %}
<div class="space-y-6">
    <!-- Header with Filters -->
    <div class="flex flex-col gap-4 bg-white p-6 rounded-2xl shadow-sm border border-zinc-200">
        <div class="flex flex-col md:flex-row md:items-center justify-between gap-4">
            <div>
                <h1 class="text-2xl font-bold tracking-tight text-zinc-900">Match Schedule</h1>
                <p class="text-zinc-500 text-sm mt-1">Upcoming fixtures and real-time AI analysis.</p>
            </div>

            <!-- Search -->
            <div class="relative w-full md:w-64">
                <input type="text" id="teamSearch" placeholder="Search teams..."
                    class="w-full pl-10 pr-4 py-2 bg-zinc-50 border border-zinc-200 rounded-lg text-sm focus:outline-none focus:ring-2 focus:ring-black focus:border-transparent transition-all">
                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                    <svg class="h-4 w-4 text-zinc-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                </div>
            </div>
        </div>

        <!-- Scrollable League Strip -->
        <div class="flex overflow-x-auto pb-2 -mx-2 px-2 gap-2 no-scrollbar"
            style="-ms-overflow-style: none; scrollbar-width: none;">
            <style>
                .no-scrollbar::-webkit-scrollbar {
                    display: none;
                }
            </style>
            {% set leagues = [
            ('all', 'All'),
            ('epl', 'EPL'),
            ('laliga', 'La Liga'),
            ('bundesliga', 'Bundesliga'),
            ('seriea', 'Serie A'),
            ('ligue1', 'Ligue 1'),
            ('ucl', 'UCL'),
            ('europa', 'Europa'),
            ('afcon', 'AFCON'),
            ('worldcup', 'World Cup'),
            ('mls', 'MLS'),
            ('brasileiro', 'Brazil Serie A'),
            ('saudi', 'Saudi Pro'),
            ('championship', 'EFL'),
            ('nba', 'NBA')
            ] %}

            {% for code, name in leagues %}
            <a href="?league={{ code }}" class="whitespace-nowrap px-4 py-2 rounded-full text-sm font-medium transition-all duration-200 flex-shrink-0
               {% if active_league == code %}
               bg-zinc-900 text-white shadow-md
               {% else %}
               bg-zinc-100 text-zinc-600 hover:bg-zinc-200
               {% endif %}">
                {{ name }}
            </a>
            {% endfor %}
        </div>
    </div>

    <!-- Live Matches -->
    {% if live_games %}
    <div class="mb-8">
        <h2 class="text-lg font-bold text-red-600 mb-4 flex items-center gap-2">
            <span class="relative flex h-3 w-3">
                <span class="animate-ping absolute inline-flex h-full w-full rounded-full bg-red-400 opacity-75"></span>
                <span class="relative inline-flex rounded-full h-3 w-3 bg-red-500"></span>
            </span>
            Live Now
        </h2>
        <div class="bg-white rounded-xl shadow-sm border border-red-100 overflow-hidden divide-y divide-zinc-100">
            {% for game in live_games %}
            {% include 'match_row_template.html' %}
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Upcoming Matches -->
    <div>
        {% if upcoming_games or (not live_games and not upcoming_games) %}
        <h2 class="text-lg font-bold text-zinc-900 mb-4">Upcoming Matches</h2>
        <div class="bg-white rounded-2xl shadow-sm border border-zinc-200 overflow-hidden">
            {% if upcoming_games %}
            <div class="divide-y divide-zinc-100">
                {% for game in upcoming_games %}
                {% include 'match_row_template.html' %}
                {% endfor %}
            </div>
            {% else %}
            <div class="flex flex-col items-center justify-center py-24 text-center">
                <div class="w-16 h-16 bg-zinc-50 rounded-full flex items-center justify-center mb-4">
                    <svg class="w-8 h-8 text-zinc-300" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                            d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z">
                        </path>
                    </svg>
                </div>
                <h3 class="text-lg font-medium text-zinc-900">No Matches Found</h3>
                <p class="text-zinc-500 mt-1 max-w-sm">No upcoming matches scheduled for this league. Try checking the
                    history or switching leagues.</p>
                <a href="?league=all" class="mt-4 text-black text-sm font-medium hover:underline">Return to All</a>
            </div>
            {% endif %}
        </div>
        {% endif %}
    </div>
</div>

<!-- Reusable Match Row Template (Inline for now to avoid multiple file creation if possible, but simpler to just write full loop content if macros not used. 
Actually, I will just replicate the inner loop content for both live and upcoming to simplify without creating new files) -->

{% include 'includes/stats_modal.html' %}

<script>
    // Client-side search for matches
    document.getElementById('teamSearch').addEventListener('keyup', function (e) {
        const term = e.target.value.toLowerCase();
        const matches = document.querySelectorAll('.group'); // Each match row has class 'group'

        matches.forEach(match => {
            const text = match.innerText.toLowerCase();
            if (text.includes(term)) {
                match.style.display = 'flex';
            } else {
                match.style.display = 'none';
            }
        });
    });
</script>

{% endblock %}